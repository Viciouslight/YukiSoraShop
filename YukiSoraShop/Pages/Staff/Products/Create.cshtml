@page
@model YukiSoraShop.Pages.Staff.Products.StaffProductCreateModel
@{
    ViewData["Title"] = "Thêm sản phẩm mới";
}

<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-plus text-primary"></i> Thêm sản phẩm mới
        </h1>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-info-circle"></i> Thông tin sản phẩm</h5>
            </div>
            <div class="card-body">
                @await Html.PartialAsync("_Alerts")
                <form method="post">
                    @Html.AntiForgeryToken()
                    <div asp-validation-summary="All" class="text-danger mb-3"></div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="Product.ProductName" class="form-label">Tên sản phẩm *</label>
                            <input asp-for="Product.ProductName" class="form-control" placeholder="Nhập tên sản phẩm" />
                            <span asp-validation-for="Product.ProductName" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="Product.Price" class="form-label">Giá *</label>
                            <input asp-for="Product.Price" class="form-control" type="number" step="0.01" placeholder="0.00" />
                            <span asp-validation-for="Product.Price" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="Product.StockQuantity" class="form-label">Số lượng *</label>
                            <input asp-for="Product.StockQuantity" class="form-control" type="number" placeholder="0" />
                            <span asp-validation-for="Product.StockQuantity" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="Product.CategoryId" class="form-label">Danh mục *</label>
                            <select asp-for="Product.CategoryId" class="form-select" asp-items="Model.CategoryOptions">
                                <option value="">-- Chọn danh mục --</option>
                            </select>
                            <span asp-validation-for="Product.CategoryId" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Product.Description" class="form-label">Mô tả</label>
                        <textarea asp-for="Product.Description" class="form-control" rows="4" placeholder="Mô tả chi tiết về sản phẩm"></textarea>
                        <span asp-validation-for="Product.Description" class="text-danger"></span>
                    </div>

                    <!-- THÔNG TIN CHI TIẾT SẢN PHẨM -->
                    <div class="mb-4">
                        <h5><i class="fas fa-list"></i> Thông tin chi tiết sản phẩm</h5>

                        <div id="product-details-container">
                            @for (int i = 0; i < Model.ProductDetails.Count; i++)
                            {
                                <div class="row mb-3 product-detail-item">
                                    <div class="col-md-5">
                                        <input asp-for="ProductDetails[@i].Color" class="form-control" placeholder="Màu sắc" />
                                        <span asp-validation-for="ProductDetails[@i].Color" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-5">
                                        <input asp-for="ProductDetails[@i].Size" class="form-control" placeholder="Kích thước" />
                                        <span asp-validation-for="ProductDetails[@i].Size" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-danger btn-remove-detail">Xóa</button>
                                    </div>
                                    <div class="col-md-6 mt-2">
                                        <input asp-for="ProductDetails[@i].Material" class="form-control" placeholder="Chất liệu" />
                                        <span asp-validation-for="ProductDetails[@i].Material" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6 mt-2">
                                        <input asp-for="ProductDetails[@i].Origin" class="form-control" placeholder="Xuất xứ" />
                                        <span asp-validation-for="ProductDetails[@i].Origin" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6 mt-2">
                                        <input asp-for="ProductDetails[@i].ImageUrl" class="form-control" placeholder="URL hình ảnh" />
                                        <span asp-validation-for="ProductDetails[@i].ImageUrl" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6 mt-2">
                                        <input asp-for="ProductDetails[@i].AdditionalPrice" class="form-control" placeholder="Giá phụ thêm" type="number" step="0.01" />
                                        <span asp-validation-for="ProductDetails[@i].AdditionalPrice" class="text-danger"></span>
                                    </div>
                                    <div class="col-12 mt-2">
                                        <textarea asp-for="ProductDetails[@i].Description" class="form-control" rows="2" placeholder="Mô tả chi tiết"></textarea>
                                        <span asp-validation-for="ProductDetails[@i].Description" class="text-danger"></span>
                                    </div>
                                </div>
                            }
                        </div>

                        <button type="button" id="add-detail" class="btn btn-secondary mt-2">Thêm biến thể mới</button>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Lưu sản phẩm
                        </button>
                        <a href="/Staff/Products/List" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Quay lại
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const container = document.getElementById('product-details-container');
        const addBtn = document.getElementById('add-detail');

        addBtn.addEventListener('click', () => {
            const index = container.children.length;
            const template = `
                <div class="row mb-3 product-detail-item">
                    <div class="col-md-5">
                        <input name="ProductDetails[${index}].Color" class="form-control" placeholder="Màu sắc" />
                    </div>
                    <div class="col-md-5">
                        <input name="ProductDetails[${index}].Size" class="form-control" placeholder="Kích thước" />
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-danger btn-remove-detail">Xóa</button>
                    </div>
                    <div class="col-md-6 mt-2">
                        <input name="ProductDetails[${index}].Material" class="form-control" placeholder="Chất liệu" />
                    </div>
                    <div class="col-md-6 mt-2">
                        <input name="ProductDetails[${index}].Origin" class="form-control" placeholder="Xuất xứ" />
                    </div>
                    <div class="col-md-6 mt-2">
                        <input name="ProductDetails[${index}].ImageUrl" class="form-control" placeholder="URL hình ảnh" />
                    </div>
                    <div class="col-md-6 mt-2">
                        <input name="ProductDetails[${index}].AdditionalPrice" class="form-control" placeholder="Giá phụ thêm" type="number" step="0.01" />
                    </div>
                    <div class="col-12 mt-2">
                        <textarea name="ProductDetails[${index}].Description" class="form-control" rows="2" placeholder="Mô tả chi tiết"></textarea>
                    </div>
                </div>`;
            container.insertAdjacentHTML('beforeend', template);
        });

        container.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn-remove-detail')) {
                e.target.closest('.product-detail-item').remove();
            }
        });
    </script>
}
